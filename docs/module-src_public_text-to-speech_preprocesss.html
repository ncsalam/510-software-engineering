<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: src/public/text-to-speech/preprocesss</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: src/public/text-to-speech/preprocesss</h1>

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>Preprocessing utilities used by the Text-To-Speech layer.</p>
<p>This module provides helpers that convert timestamps, numbers, currency
amounts and long text into forms that are easier and more natural for
speech synthesis engines to speak. Functions are written defensively and
operate on plain strings.</p></div>
        

        
            















<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line1">line 1</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id=".chunkText"><span class="type-signature">(static) </span>chunkText<span class="signature">(text, maxLen)</span><span class="type-signature"> &rarr; {Array.&lt;string>}</span></h4>
    

    



<div class="description">
    <p>Split text into paragraph-sized chunks for TTS playback.</p>
<p>The function first splits the text at blank lines into paragraphs and
trims them. Paragraphs shorter than or equal to <code>maxLen</code> are returned
unchanged. Longer paragraphs are broken into smaller chunks by
<code>splitByLen</code>, which prefers natural word/punctuation boundaries.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>text</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>input text</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>maxLen</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>maximum allowed chunk length</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line280">line 280</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>array of chunks, each no longer than maxLen (unless a
single token exceeds maxLen in which case it will be cut)</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array.&lt;string></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id=".dollarsToWords"><span class="type-signature">(static) </span>dollarsToWords<span class="signature">(numeric)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Convert a numeric dollar amount (no leading &quot;$&quot;) into a spoken phrase.</p>
<p>The function accepts strings like &quot;123.45&quot; or &quot;0.50&quot; and returns
speech-friendly text such as &quot;one hundred twenty-three dollars and
forty five cents&quot; or &quot;fifty cents&quot;. It handles rounding of fractional
cents (e.g., &quot;.999&quot; rounds to the next dollar when appropriate).</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>numeric</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>numeric dollar value (no currency symbol)</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line157">line 157</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>spoken dollar amount</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id=".englishifyNumbers"><span class="type-signature">(static) </span>englishifyNumbers<span class="signature">(s)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Expand numeric tokens, currencies and percentages into words for speech.</p>
<p>This function performs three main transformations (in order):</p>
<ol>
<li>Dollar amounts (e.g. &quot;$19.99&quot;, &quot;-$123.45&quot;) are converted to words
with dollars and cents spelled out.</li>
<li>Percentages (e.g. &quot;12.5%&quot;, &quot;7%&quot;) are expanded to &quot;percent&quot; with
decimal digits read as point-separated digits.</li>
<li>Remaining standalone numbers (integers and decimals) are converted
to words. For decimals, the fractional part is read digit-by-digit
after the word &quot;point&quot;.</li>
</ol>
<p>The function preserves leading whitespace for dollar/percent matches so
the surrounding sentence spacing remains correct.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>s</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>input text</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line89">line 89</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>transformed text with numeric tokens expanded</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id=".englishifyTimes"><span class="type-signature">(static) </span>englishifyTimes<span class="signature">(s)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Replace clock/time patterns in <code>s</code> with natural spoken equivalents.</p>
<p>This function finds common time formats in the input string (&quot;HH:MM AM/PM&quot;
and &quot;HH AM/PM&quot;, case-insensitive, with optional punctuation like &quot;a.m.&quot;)
and converts each match into a short phrase suitable for TTS. It leaves
other text in <code>s</code> unchanged.</p>
<p>Examples:</p>
<ul>
<li>&quot;10:00 PM&quot; -&gt; &quot;ten o'clock pm&quot;</li>
<li>&quot;3:05 a.m.&quot; -&gt; &quot;three oh five am&quot;</li>
<li>&quot;7 PM&quot; -&gt; &quot;seven pm&quot;</li>
</ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>s</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>input text</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line30">line 30</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>transformed text with times expanded for speech</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id=".intToWordsSafe"><span class="type-signature">(static) </span>intToWordsSafe<span class="signature">(intStr)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Convert an integer string to English words for numbers up to 999,999,999.</p>
<p>For numeric strings longer than 9 digits or non-finite values this
function falls back to spelling each digit individually (e.g. &quot;1234567890&quot;
-&gt; &quot;one two three ...&quot;). This keeps pronunciations predictable for
extremely large inputs.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>intStr</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>integer value</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line191">line 191</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>English words for the integer or digit-spelled fallback</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="~digitWord"><span class="type-signature">(inner) </span>digitWord<span class="signature">(d)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Return the English word for a single digit character.</p>
<p>If input is not a numeric digit this function returns the original
character so callers can safely map over mixed input.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>d</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>single digit (e.g. '0'..'9')</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line208">line 208</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>word for the digit (e.g. 'zero') or the original input</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="~numberToWordsUnderBillion"><span class="type-signature">(inner) </span>numberToWordsUnderBillion<span class="signature">(n)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Convert an integer 0..999,999,999 into English words.</p>
<p>This is a helper used by <code>intToWordsSafe</code> and <code>dollarsToWords</code>. It
produces compact phrases like &quot;one hundred twenty-three million four
hundred fifty-six thousand seven hundred eighty-nine&quot;.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>n</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>integer in range 0..999,999,999</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line222">line 222</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>English words for <code>n</code></p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="~splitByLen"><span class="type-signature">(inner) </span>splitByLen<span class="signature">(s, maxLen)</span><span class="type-signature"> &rarr; {Array.&lt;string>}</span></h4>
    

    



<div class="description">
    <p>Heuristically split a long string into pieces under <code>maxLen</code>.</p>
<p>The splitter tokenizes on whitespace and common punctuation then builds
chunks by appending tokens until the limit is reached. Very long tokens
(longer than <code>maxLen</code>) are sliced into <code>maxLen</code>-sized pieces.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>s</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>paragraph to split</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>maxLen</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>maximum chunk length</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line306">line 306</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>array of chunks</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array.&lt;string></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="~timeToWords"><span class="type-signature">(inner) </span>timeToWords<span class="signature">(hStr, mStr, apLetter)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Convert parsed hour/minute tokens into a spoken time phrase.</p>
<p>This internal helper expects strings captured by the regexes in
<code>englishifyTimes</code> (hour string, minute string or null, and an AM/PM
letter). It normalizes the hour into 12-hour form and produces phrases
like &quot;seven pm&quot;, &quot;ten o'clock pm&quot;, or &quot;three oh five am&quot;.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>hStr</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>hour token as matched by the regex (e.g. &quot;3&quot;, &quot;10&quot;)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>mStr</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">null</span>


            
            </td>

            

            

            <td class="description last"><p>minute token (e.g. &quot;05&quot;) or null when absent</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>apLetter</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>single-letter AM/PM marker (case-insensitive)</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="public_text-to-speech_preprocess.mjs.html">public/text-to-speech/preprocess.mjs</a>, <a href="public_text-to-speech_preprocess.mjs.html#line55">line 55</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>spoken representation suitable for TTS</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-app.html">app</a></li><li><a href="module-server_chat-db.html">server/chat-db</a></li><li><a href="module-server_ollama-interface.html">server/ollama-interface</a></li><li><a href="module-server_sqlite3-async.html">server/sqlite3-async</a></li><li><a href="module-server_terminal-helper.html">server/terminal-helper</a></li><li><a href="module-server_validation.html">server/validation</a></li><li><a href="module-src_public_llm_response.html">src/public/llm_response</a></li><li><a href="module-src_public_text-to-speech_preprocesss.html">src/public/text-to-speech/preprocesss</a></li><li><a href="module-src_public_text-to-speech_text-to-speech.html">src/public/text-to-speech/text-to-speech</a></li></ul><h3>Global</h3><ul><li><a href="global.html#wirePage">wirePage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Nov 05 2025 21:38:56 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>